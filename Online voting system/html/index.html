<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voting Page</title>
  <link rel="stylesheet" type="text/css" href="../css/index.css" />
</head>

<body>
  <div id="head" class="text-center">
    <h1 align="center">Online Voting System</h1>
    <h2 align="center">Welcome for Voting</h2>
    <h3 align="center">
      <p>Voting Dates: <span id="dates">Loading...</span></p>
    </h3>
    <br />
  </div>

  <div id="candidate" class="container">
    <table class="table text-center">
      <thead>
        <tr>
          <th>Select</th>
          <th>Name</th>
          <th>Party</th>
          <th>Total Vote</th>
        </tr>
      </thead>
      <tbody id="candidateList"></tbody>
    </table>

    <div id="vote">
      <p>Please select one of the candidates and click the vote button.</p>
      <button id="voteButton" class="btn btn-primary" onclick="castVote()">Vote</button>
      <div id="msg" style="margin-top: 10px; font-weight: bold;"></div>
    </div>
  </div>

  <div id="account">
    <p id="accountAddress" class="text-center">Logged in as: demo-user</p>
  </div>

  <script>
    function loadCandidates() {
      const candidates = JSON.parse(localStorage.getItem("candidates")) || [];
      const tbody = document.getElementById("candidateList");
      tbody.innerHTML = "";

      candidates.forEach((c, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input type="radio" name="candidate" value="${index}" /></td>
          <td>${c.name}</td>
          <td>${c.party}</td>
          <td>${c.votes}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadVotingDates() {
      const dates = JSON.parse(localStorage.getItem("votingDates"));
      if (dates) {
        document.getElementById("dates").innerText = `${dates.start} to ${dates.end}`;
      } else {
        document.getElementById("dates").innerText = "Not set";
      }
    }

    function castVote() {
      const candidates = JSON.parse(localStorage.getItem("candidates")) || [];
      const selected = document.querySelector('input[name="candidate"]:checked');

      if (!selected) {
        alert("Please select a candidate.");
        return;
      }

      const index = parseInt(selected.value);
      candidates[index].votes += 1;

      localStorage.setItem("candidates", JSON.stringify(candidates));
      alert(`You voted for ${candidates[index].name}`);
      document.getElementById("voteButton").disabled = true;
      document.getElementById("msg").innerText = "Thank you for voting!";
      loadCandidates(); // Refresh vote count
    }

    window.onload = function () {
      loadCandidates();
      loadVotingDates();
    };
  </script>
</body>
</html>
